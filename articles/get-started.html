<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="PopulationSynthesiser">
<title>Get Started • PopulationSynthesiser</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Get Started">
<meta property="og:description" content="PopulationSynthesiser">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">PopulationSynthesiser</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.5</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/data-preparation.html">Data Preparation</a>
    <a class="dropdown-item" href="../articles/get-started.html">Get Started</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/AURIN-OFFICE/RCITI_PopulationSynthesiser/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Get Started</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/AURIN-OFFICE/RCITI_PopulationSynthesiser/blob/HEAD/vignettes/get-started.Rmd" class="external-link"><code>vignettes/get-started.Rmd</code></a></small>
      <div class="d-none name"><code>get-started.Rmd</code></div>
    </div>

    
    
<p>In this article, we’re going to show you how to pre-process your
microdata and control tables using the {PopulationSynthesiser} package,
then use the <code>mlfit</code> package generate synthetic population
data. We’ll use the Australian Census 2016 data as an example. After we
have generated the synthetic population, we’ll use the
<code>postfit_*</code> functions to convert the synthetic population
into a format that can be used by <a href="https://aurin-office.github.io/RCITI_ActivityGenerator/" class="external-link">ActivityGenerator</a>.
We refer to this format the ‘CVISTA’ format, which stands for
‘Close-enough to VISTA’.</p>
<div class="section level2">
<h2 id="before-we-get-started">Before we get started!<a class="anchor" aria-label="anchor" href="#before-we-get-started"></a>
</h2>
<p>In the following example, we will be using a few other R packages
wasn’t shipped with your R program, they provide useful functions for
transforming and visualising data. So make sure you have installed all
these following packages using
<code>install.packages("&lt;packge-name&gt;")</code>.</p>
<ul>
<li>
<code>dplyr</code> for summarising data in a data.frame.</li>
<li>
<code>sf</code> for working with spatial data.</li>
<li>
<code>mapview</code> for plotting spatial data.</li>
</ul>
<p>and of course we will need this package,
<code>PopulationSynthesiser</code> as well. However, installing this is
a bit different as the package is not yet officially on CRAN. Please
follow the ‘Installation’ section on the README page to install the
package.</p>
</div>
<div class="section level2">
<h2 id="loading-the-datasets-into-r">Loading the datasets into R<a class="anchor" aria-label="anchor" href="#loading-the-datasets-into-r"></a>
</h2>
<p>We should now have 2 person control tables, 1 household control
table, and 1 microdata. Let’s import all of them into R. We can use
these functions to read them into R. Notice that, in
<code><a href="../reference/read_census_microdata.html">read_census_microdata()</a></code> you have to state the
<code>census_year</code> of your microdata and the names of the columns
that you would like to select in <code>select</code>.
<code>census_year</code> helps the package to correctly identify the
geographical boundary variables in the microdata. <code>select</code> is
optional, but when stated it can help to reduce the time it takes to
import the microdata.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/AURIN-OFFICE/RCITI_PopulationSynthesiser" class="external-link">PopulationSynthesiser</a></span><span class="op">)</span></span>
<span><span class="va">microdata</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/read_census_microdata.html">read_census_microdata</a></span><span class="op">(</span></span>
<span>    person_file <span class="op">=</span> <span class="st">"datasets/Census2016_CSV/BCSF16_person_new.csv"</span>,</span>
<span>    family_file <span class="op">=</span> <span class="st">"datasets/Census2016_CSV/BCSF16_family.csv"</span>,</span>
<span>    dwelling_file <span class="op">=</span> <span class="st">"datasets/Census2016_CSV/BCSF16_dwelling.csv"</span>,</span>
<span>    census_year <span class="op">=</span> <span class="st">"2016"</span>,</span>
<span>    select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"regucp"</span>, <span class="st">"agep"</span>, <span class="st">"mstp"</span>, <span class="st">"sexp"</span>, <span class="st">"nprd"</span>, <span class="st">"occp"</span>, <span class="st">"rlhp"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/create_fitting_sample.html">create_fitting_sample</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">person_control_1</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/read_census_tablebuilder.html">read_census_tablebuilder</a></span><span class="op">(</span><span class="st">"datasets/person_control_1.csv"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/create_fitting_control.html">create_fitting_control</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">person_control_2</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/read_census_tablebuilder.html">read_census_tablebuilder</a></span><span class="op">(</span><span class="st">"datasets/person_control_2.csv"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/create_fitting_control.html">create_fitting_control</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">household_control_1</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/read_census_tablebuilder.html">read_census_tablebuilder</a></span><span class="op">(</span><span class="st">"datasets/household_control_1.csv"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/create_fitting_control.html">create_fitting_control</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Here are the datasets that we have just loaded into R. Note that, we
are not printing out the microdata as is because no ABS microdata should
never be shared in its raw form<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;a href="https://www.abs.gov.au/ausstats/abs@.nsf/Lookup/by%20Subject/1406.0.55.003~User%20Guide~Main%20Features~Using%20microdata%20responsibly~25" class="external-link uri"&gt;https://www.abs.gov.au/ausstats/abs@.nsf/Lookup/by%20Subject/1406.0.55.003~User%20Guide~Main%20Features~Using%20microdata%20responsibly~25&lt;/a&gt;&lt;/p&gt;'><sup>1</sup></a>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">microdata</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_if</a></span><span class="op">(</span><span class="va">is.character</span>, <span class="va">as.factor</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#&gt;      abshid          absfid           abspid                agep       </span></span>
<span><span class="co">#&gt;  Min.   :    1   Min.   :     1   Min.   :     1   30-34 years: 16781  </span></span>
<span><span class="co">#&gt;  1st Qu.:23964   1st Qu.: 25630   1st Qu.: 58881   25-29 years: 16488  </span></span>
<span><span class="co">#&gt;  Median :47087   Median : 50352   Median :117651   40-44 years: 15868  </span></span>
<span><span class="co">#&gt;  Mean   :47324   Mean   : 50629   Mean   :117686   45-49 years: 15692  </span></span>
<span><span class="co">#&gt;  3rd Qu.:70473   3rd Qu.: 75529   3rd Qu.:176656   35-39 years: 15378  </span></span>
<span><span class="co">#&gt;  Max.   :94988   Max.   :101523   Max.   :235408   50-54 years: 15173  </span></span>
<span><span class="co">#&gt;                                                    (Other)    :136873  </span></span>
<span><span class="co">#&gt;              mstp                                           occp       </span></span>
<span><span class="co">#&gt;  Divorced      :16489   Not applicable                        :125813  </span></span>
<span><span class="co">#&gt;  Married       :91167   Professionals                         : 23665  </span></span>
<span><span class="co">#&gt;  Never married :65731   Clerical and Administrative Workers   : 14522  </span></span>
<span><span class="co">#&gt;  Not applicable:43016   Technicians and Trades Workers        : 14461  </span></span>
<span><span class="co">#&gt;  Separated     : 6170   Managers                              : 13754  </span></span>
<span><span class="co">#&gt;  Widowed       : 9680   Community and Personal Service Workers: 11651  </span></span>
<span><span class="co">#&gt;                         (Other)                               : 28387  </span></span>
<span><span class="co">#&gt;      regucp                            rlhp           sexp       </span></span>
<span><span class="co">#&gt;  Min.   : 1.00   Husband, Wife or Partner:97510   Female:118040  </span></span>
<span><span class="co">#&gt;  1st Qu.:14.00   Child under 15          :40180   Male  :114213  </span></span>
<span><span class="co">#&gt;  Median :27.00   Non-family member       :27629                  </span></span>
<span><span class="co">#&gt;  Mean   :27.38   Lone person             :20387                  </span></span>
<span><span class="co">#&gt;  3rd Qu.:41.00   Non-dependent child     :13171                  </span></span>
<span><span class="co">#&gt;  Max.   :57.00   Dependent student       :10794                  </span></span>
<span><span class="co">#&gt;                  (Other)                 :22582                  </span></span>
<span><span class="co">#&gt;              nprd      </span></span>
<span><span class="co">#&gt;  Five persons  :27253  </span></span>
<span><span class="co">#&gt;  Four persons  :51121  </span></span>
<span><span class="co">#&gt;  Not applicable:20266  </span></span>
<span><span class="co">#&gt;  One person    :21789  </span></span>
<span><span class="co">#&gt;  Six persons   :17280  </span></span>
<span><span class="co">#&gt;  Three persons :39003  </span></span>
<span><span class="co">#&gt;  Two persons   :55541</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">person_control_1</span><span class="op">)</span></span>
<span><span class="co">#&gt;          sa2 sexp           mstp count</span></span>
<span><span class="co">#&gt; 1: 118021569 Male  Never married  3243</span></span>
<span><span class="co">#&gt; 2: 118021569 Male        Widowed   125</span></span>
<span><span class="co">#&gt; 3: 118021569 Male       Divorced   431</span></span>
<span><span class="co">#&gt; 4: 118021569 Male      Separated   159</span></span>
<span><span class="co">#&gt; 5: 118021569 Male        Married  2671</span></span>
<span><span class="co">#&gt; 6: 118021569 Male Not applicable  1337</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">person_control_2</span><span class="op">)</span></span>
<span><span class="co">#&gt;          sa2                                   occp count</span></span>
<span><span class="co">#&gt; 1: 118021569                               Managers  1618</span></span>
<span><span class="co">#&gt; 2: 118021569                          Professionals  3740</span></span>
<span><span class="co">#&gt; 3: 118021569         Technicians and Trades Workers   850</span></span>
<span><span class="co">#&gt; 4: 118021569 Community and Personal Service Workers   858</span></span>
<span><span class="co">#&gt; 5: 118021569    Clerical and Administrative Workers  1184</span></span>
<span><span class="co">#&gt; 6: 118021569                          Sales Workers   656</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">household_control_1</span><span class="op">)</span></span>
<span><span class="co">#&gt;          sa2          nprd count</span></span>
<span><span class="co">#&gt; 1: 118021569    One person  1861</span></span>
<span><span class="co">#&gt; 2: 118021569   Two persons  2538</span></span>
<span><span class="co">#&gt; 3: 118021569 Three persons  1139</span></span>
<span><span class="co">#&gt; 4: 118021569  Four persons   879</span></span>
<span><span class="co">#&gt; 5: 118021569  Five persons   252</span></span>
<span><span class="co">#&gt; 6: 118021569   Six persons    48</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="synthesise-the-population">Synthesise the population<a class="anchor" aria-label="anchor" href="#synthesise-the-population"></a>
</h2>
<p>We are now going to create fitting problems, one for each zone. This
will help us to sample only the records in the microdata that
geographically match our control totals’ zones.</p>
<p>For example, if our microdata contains people from four different
zones as shown in the image below.</p>
<p><img src="../reference/figures/fitting_problem-sampling-1.png"></p>
<p>But our fitting problem is only for a zone (the orange patch) in one
of those regions. In this case, each fitting problem will only sample
people from the region that contains the zone to be in the reference
sample of the fitting problem.</p>
<p><img src="../reference/figures/fitting_problem-sampling-2.png"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlfit.github.io/mlfit/" class="external-link">mlfit</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">geo_hierarchy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/csf_geo.html">csf_geo2016</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">geo_hierarchy</span><span class="op">)</span></span>
<span><span class="co">#&gt;    regucp       sa2</span></span>
<span><span class="co">#&gt; 1:      1 101021007</span></span>
<span><span class="co">#&gt; 2:      1 101021008</span></span>
<span><span class="co">#&gt; 3:      1 101021009</span></span>
<span><span class="co">#&gt; 4:      1 101021010</span></span>
<span><span class="co">#&gt; 5:      1 101021011</span></span>
<span><span class="co">#&gt; 6:      1 101021012</span></span>
<span></span>
<span><span class="va">fitting_problems</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mlfit.github.io/mlfit/reference/ml_problem.html" class="external-link">ml_problem</a></span><span class="op">(</span></span>
<span>  ref_sample <span class="op">=</span> <span class="va">microdata</span>,</span>
<span>  field_names <span class="op">=</span> <span class="fu"><a href="https://mlfit.github.io/mlfit/reference/ml_problem.html" class="external-link">special_field_names</a></span><span class="op">(</span></span>
<span>    groupId <span class="op">=</span> <span class="st">"abshid"</span>, individualId <span class="op">=</span> <span class="st">"abspid"</span>, count <span class="op">=</span> <span class="st">"count"</span>,</span>
<span>    zone <span class="op">=</span> <span class="st">"sa2"</span>, region <span class="op">=</span> <span class="st">"regucp"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  group_controls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">household_control_1</span><span class="op">)</span>,</span>
<span>  individual_controls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">person_control_1</span>, <span class="va">person_control_2</span><span class="op">)</span>,</span>
<span>  geo_hierarchy <span class="op">=</span> <span class="va">geo_hierarchy</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Creating a list of fitting problems by zone</span></span>
<span></span>
<span><span class="va">ml_problem</span> <span class="op">&lt;-</span> <span class="va">fitting_problems</span><span class="op">[[</span><span class="st">"118021569"</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/prefit_csf_agep_to_age5p.html">prefit_csf_agep_to_age5p</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>To solve our fitting problem we can use <code><a href="https://mlfit.github.io/mlfit/reference/ml_fit.html" class="external-link">ml_fit()</a></code> from
the <code>mlfit</code> package. This package provides 4 different
multi-level fitting algorithms: entropy_o, dss, ipu, hipf. See
<code><a href="https://mlfit.github.io/mlfit/reference/ml_fit.html" class="external-link">?mlfit::ml_fit</a></code> to learn more about the algorithms. Here we
are going to use the famous Iterative Proportion Updating algorithm
(<code>ipu</code>) to solve our fitting problem.</p>
<p>Although, the algorithm did not reach a convergence for this fitting
problem, but the errors are quite small. Priting out
<code>fitting_result</code> to console provides some useful results of
your fitting problem.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fitting_result</span> <span class="op">&lt;-</span> <span class="fu">mlfit</span><span class="fu">::</span><span class="fu"><a href="https://mlfit.github.io/mlfit/reference/ml_fit.html" class="external-link">ml_fit</a></span><span class="op">(</span>algorithm <span class="op">=</span> <span class="st">"ipu"</span>, <span class="va">ml_problem</span><span class="op">)</span></span>
<span><span class="va">fitting_result</span></span>
<span><span class="co">#&gt; An object of class ml_fit</span></span>
<span><span class="co">#&gt;   Algorithm: ipu</span></span>
<span><span class="co">#&gt;   Success: FALSE</span></span>
<span><span class="co">#&gt;   Residuals (absolute): min = -0.02301994, max = 2.829837</span></span>
<span><span class="co">#&gt;   Flat problem:</span></span>
<span><span class="co">#&gt;   An object of class flat_ml_fit_problem</span></span>
<span><span class="co">#&gt;     Dimensions: 30 groups, 1192 target values</span></span>
<span><span class="co">#&gt;     Model matrix type: separate</span></span>
<span><span class="co">#&gt;     Original fitting problem:</span></span>
<span><span class="co">#&gt;     An object of class ml_problem</span></span>
<span><span class="co">#&gt;       Reference sample: 2639 observations</span></span>
<span><span class="co">#&gt;       Control totals: 2 at individual, and 1 at group level</span></span>
<span><span class="co">#&gt;       Zone: 118021569</span></span></code></pre></div>
<p>Now let’s replicate each record in the reference sample by its
fitted/calibrated weights. You can use
<code><a href="https://mlfit.github.io/mlfit/reference/ml_replicate.html" class="external-link">mlfit::ml_replicate()</a></code> to do that. Lookup
<code><a href="https://mlfit.github.io/mlfit/reference/ml_replicate.html" class="external-link">?mlfit::ml_replicate</a></code> to see the definitions of its
arguments.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">full_population</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://mlfit.github.io/mlfit/reference/ml_replicate.html" class="external-link">ml_replicate</a></span><span class="op">(</span><span class="va">fitting_result</span>, algorithm <span class="op">=</span> <span class="st">"trs"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">full_population</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_if</a></span><span class="op">(</span><span class="va">is.character</span>, <span class="va">as.factor</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;      abshid         absfid           abspid               agep     </span></span>
<span><span class="co">#&gt;  Min.   :   1   Min.   :  1008   Min.   :    1   35-39 years:1945  </span></span>
<span><span class="co">#&gt;  1st Qu.:1974   1st Qu.: 17458   1st Qu.: 4218   25-29 years:1693  </span></span>
<span><span class="co">#&gt;  Median :3502   Median : 17734   Median : 8436   30-34 years:1393  </span></span>
<span><span class="co">#&gt;  Mean   :3756   Mean   : 18132   Mean   : 8436   40-44 years:1191  </span></span>
<span><span class="co">#&gt;  3rd Qu.:5568   3rd Qu.: 18090   3rd Qu.:12653   55-59 years:1189  </span></span>
<span><span class="co">#&gt;  Max.   :7788   Max.   :100648   Max.   :16870   45-49 years:1184  </span></span>
<span><span class="co">#&gt;                                                  (Other)    :8275  </span></span>
<span><span class="co">#&gt;              mstp                                          occp     </span></span>
<span><span class="co">#&gt;  Divorced      :1061   Not applicable                        :7273  </span></span>
<span><span class="co">#&gt;  Married       :5314   Professionals                         :3730  </span></span>
<span><span class="co">#&gt;  Never married :6853   Managers                              :1622  </span></span>
<span><span class="co">#&gt;  Not applicable:2670   Clerical and Administrative Workers   :1184  </span></span>
<span><span class="co">#&gt;  Separated     : 359   Community and Personal Service Workers: 856  </span></span>
<span><span class="co">#&gt;  Widowed       : 613   Technicians and Trades Workers        : 852  </span></span>
<span><span class="co">#&gt;                        (Other)                               :1353  </span></span>
<span><span class="co">#&gt;      regucp                         rlhp          sexp     </span></span>
<span><span class="co">#&gt;  Min.   :10   Husband, Wife or Partner:5898   Female:8886  </span></span>
<span><span class="co">#&gt;  1st Qu.:10   Non-family member       :4450   Male  :7984  </span></span>
<span><span class="co">#&gt;  Median :10   Lone person             :1848                </span></span>
<span><span class="co">#&gt;  Mean   :10   Child under 15          :1243                </span></span>
<span><span class="co">#&gt;  3rd Qu.:10   Non-dependent child     : 949                </span></span>
<span><span class="co">#&gt;  Max.   :10   Not applicable          : 738                </span></span>
<span><span class="co">#&gt;               (Other)                 :1744                </span></span>
<span><span class="co">#&gt;              nprd              age5p     </span></span>
<span><span class="co">#&gt;  Five persons  :1126   35-39 years:1945  </span></span>
<span><span class="co">#&gt;  Four persons  :2692   25-29 years:1693  </span></span>
<span><span class="co">#&gt;  Not applicable:3452   20-24 years:1571  </span></span>
<span><span class="co">#&gt;  One person    :2034   30-34 years:1393  </span></span>
<span><span class="co">#&gt;  Six persons   : 266   40-44 years:1191  </span></span>
<span><span class="co">#&gt;  Three persons :2767   55-59 years:1189  </span></span>
<span><span class="co">#&gt;  Two persons   :4533   (Other)    :7888</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">full_population</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 16870</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">person_control_1</span><span class="op">$</span><span class="va">count</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 16866</span></span></code></pre></div>
<p>Our fitting problem only has 2639 rows in its reference sample. But
once we replicate them, we will have 16870 rows which should closely
matched our control totals, as shown by the output of
<code>dim(full_population)</code>.</p>
</div>
<div class="section level2">
<h2 id="post-processing">Post processing<a class="anchor" aria-label="anchor" href="#post-processing"></a>
</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">full_population</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/postfit_add_relationships.html">postfit_add_relationships</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># add ids of their partner, father, and mother to each individual</span></span>
<span>  <span class="fu"><a href="../reference/postfit_integerise_age5p.html">postfit_integerise_age5p</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># turn five-year age groups into single year</span></span>
<span>  <span class="va">.</span><span class="op">[</span>, <span class="va">.SD</span>, .SDcols <span class="op">=</span> <span class="fu">patterns</span><span class="op">(</span><span class="st">"_id$|^age$"</span><span class="op">)</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># select only rows that have a partner, father, or mother using data.table syntax not equal to NA</span></span>
<span>  <span class="va">.</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">partner_id</span><span class="op">)</span> <span class="op">|</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">father_id</span><span class="op">)</span> <span class="op">|</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">mother_id</span><span class="op">)</span><span class="op">]</span> </span>
<span><span class="co">#&gt; ℹ Checking inputs</span></span>
<span><span class="co">#&gt; ℹ Creating relationship id fields: `partner_id`, `father_id`, `mother_id`</span></span>
<span><span class="co">#&gt; ℹ Joining all members with other members (including self) in the same family household</span></span>
<span><span class="co">#&gt; ℹ Adding relationships</span></span>
<span><span class="co">#&gt; ℹ Cleaning up</span></span>
<span><span class="co">#&gt; ✔ Done</span></span>
<span><span class="co">#&gt;       partner_id father_id mother_id age</span></span>
<span><span class="co">#&gt;    1:        284        NA        NA  53</span></span>
<span><span class="co">#&gt;    2:        283        NA        NA  46</span></span>
<span><span class="co">#&gt;    3:         NA       283       284  15</span></span>
<span><span class="co">#&gt;    4:         NA       283       284  12</span></span>
<span><span class="co">#&gt;    5:         NA       283       284  12</span></span>
<span><span class="co">#&gt;   ---                                   </span></span>
<span><span class="co">#&gt; 7937:         NA        NA     16524   4</span></span>
<span><span class="co">#&gt; 7938:         NA        NA     16527   4</span></span>
<span><span class="co">#&gt; 7939:         NA        NA     16530   3</span></span>
<span><span class="co">#&gt; 7940:         NA        NA     16533   2</span></span>
<span><span class="co">#&gt; 7941:         NA        NA     16536   0</span></span></code></pre></div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Amarin Siripanich, Taha Rashidi, Australian Urban Research Infrastructure Network (AURIN).</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
